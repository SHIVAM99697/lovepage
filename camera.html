<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Birthday Surprise ðŸŽ‚</title>

<!-- Face detection -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/face_detection.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<style>
body{
  margin:0;height:100vh;display:flex;justify-content:center;align-items:center;
  background:#111;font-family:Arial;color:#fff
}
.wrap{width:900px;max-width:95%;text-align:center}
.videoBox{
  position:relative;display:inline-block;border-radius:18px;overflow:hidden;
  box-shadow:0 0 30px rgba(255,46,99,.7)
}
video,canvas{width:420px;height:320px;object-fit:cover}
.frame{
  position:absolute;inset:0;border:12px solid #ff2e63;border-radius:18px;
  pointer-events:none
}
#count{
  position:absolute;inset:0;display:flex;justify-content:center;align-items:center;
  font-size:96px;background:rgba(0,0,0,.4)
}
.hb{font-size:36px;color:#ff2e63;margin:14px 0}
.gifs img{width:120px;margin:6px;border-radius:12px}
#result{display:none}
</style>
</head>

<body>
<div class="wrap">
  <div class="videoBox">
    <video id="v" autoplay playsinline></video>
    <canvas id="c" style="display:none"></canvas>
    <div class="frame"></div>
    <div id="count" style="display:none">3</div>
  </div>

  <div id="result">
    <div class="hb">Happy Birthday ðŸŽ‰ðŸŽ‚</div>
    <div class="gifs">
      <img src="https://media.giphy.com/media/26FPpSuhgHvYo9Kyk/giphy.gif">
      <img src="https://media.giphy.com/media/3o6fJ1BM7R2EBRDnxK/giphy.gif">
      <img src="https://media.giphy.com/media/l0MYt5jPR6QX5pnqM/giphy.gif">
    </div>
  </div>
</div>

<script>
const v = document.getElementById('v');
const c = document.getElementById('c');
const count = document.getElementById('count');
const res = document.getElementById('result');

let started=false, captured=false;

// Camera ON
navigator.mediaDevices.getUserMedia({video:true})
  .then(s => v.srcObject = s);

// Face Detection
const fd = new FaceDetection({
  locateFile: f => `https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/${f}`
});
fd.setOptions({ model:'short', minDetectionConfidence:0.4 });

fd.onResults(r=>{
  if(r.detections.length>0 && !started && !captured){
    started=true;
    startCountdown();
  }
});

const cam = new Camera(v,{
  onFrame: async()=> fd.send({image:v}),
  width:420,height:320
});
cam.start();

// 3 â†’ 2 â†’ 1 â†’ SNAP
function startCountdown(){
  let n=3;
  count.style.display='flex';
  count.textContent=n;
  const id=setInterval(()=>{
    n--;
    if(n>0){
      count.textContent=n;
    }else{
      clearInterval(id);
      count.style.display='none';
      snap();
    }
  },1000);
}

// Auto capture
function snap(){
  captured=true;
  c.width=v.videoWidth; c.height=v.videoHeight;
  c.getContext('2d').drawImage(v,0,0,c.width,c.height);
  v.style.display='none';
  c.style.display='block';
  res.style.display='block';
}
</script>
</body>
</html>
